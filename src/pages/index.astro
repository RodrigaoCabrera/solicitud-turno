---
import Typography from "@/astro-components/Typography.astro";
import Layout from "../layouts/Layout.astro";
import {
  db,
  eq,
  Tutors,
  Patients,
  Appointments,
  Availability,
  ProfessionalProfile,
} from "astro:db";

const appointments = await db
  .select()
  .from(Appointments)
  .innerJoin(Patients, eq(Appointments.patientId, Patients.id))
  .innerJoin(Tutors, eq(Patients.tutorId, Tutors.id));

const availability = await db.select().from(ProfessionalProfile);
console.log({ availability });
---

<Layout title="Turnos app">
  <main>
    <Typography as="h3" class="font-semibold" color="black" variant="xs"
      >Turnas</Typography
    >
    <table>
      <thead>
        <tr>
          <td>Is active</td>
          <td>Nombre del paciente</td>
          <td>Dni del paciente</td>
          <td>Nombre del tutor</td>
          <td>Fecha el turno</td>
          <td>Turno id</td>
        </tr>
      </thead>
      <tbody>
        {
          appointments.map((appointment) => (
            <tr>
              <td>
                {appointment.Appointments.isActive ? "activo" : "No activo"}
              </td>
              <td>{appointment.Patients.firstName}</td>
              <td>{appointment.Patients.dni}</td>
              <td>{appointment.Tutors.firstName}</td>
              <td>{appointment.Appointments.date}</td>
              <td>{appointment.Appointments.id}</td>
            </tr>
          ))
        }
      </tbody>
    </table>

    <a type="button" href="/calendar">Reservar turno</a>
  </main>
</Layout>

<style></style>
