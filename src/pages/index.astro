---
import Layout from "../layouts/Layout.astro";
import { db, eq, Tutors, Patients, Appointments } from "astro:db";

const appointments = await db
  .select()
  .from(Appointments)
  .innerJoin(Patients, eq(Appointments.patientId, Patients.id))
  .innerJoin(Tutors, eq(Patients.tutorId, Tutors.id));

//const Appointments = await db.select().from(Appointments);
---

<Layout title="Welcome to Astro.">
  <main>
    <h1>Turnos</h1>
    <table>
      <thead>
        <tr>
          <td>Nombre del paciente</td>
          <td>Dni del paciente</td>
          <td>Nombre del tutor</td>
          <td>Fecha el turno</td>
          <td>Hora el turno</td>
        </tr>
      </thead>
      <tbody>
        {
          appointments.map((appointment) => (
            <tr>
              <td>{appointment.Patients.firstName}</td>
              <td>{appointment.Patients.dni}</td>
              <td>{appointment.Tutors.firstName}</td>
              <td>{appointment.Appointments.appointmentDate}</td>
              <td>{appointment.Appointments.appointmentTime}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </main>
</Layout>

<style></style>
